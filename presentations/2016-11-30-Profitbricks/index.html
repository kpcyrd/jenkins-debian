<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>jenkins.debian.net or what is Debian doing with all these ressources</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/black.css" id="theme">

  <style type="text/css">
  li {
    margin-top: 28px !important;
  }
  ul ul li {
    margin-top: 16px !important;
  }
  * {
    text-transform: none !important;
  }
  a {
    color: inherit !important;
  }
  code {
    font-size: 90% !important;
  }
  table {
    width: 100%;
  }
  .reveal table td {
    border-bottom: none;
  }
  .reveal section img {
    border: none;
    box-shadow: none;
  }
  </style>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <script>
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  document.getElementsByTagName('head')[0].appendChild( link );
</script>
</head>

<!--

42min :)

who are you?
	who knows about Debian? ;-)
	who knows about jenkins.debian.net?

about debian release names
	wheezy (Debian 7) = oldstable
	jessie (8) = stable
	stretch (9 =  testing
	sid = unstable
	experimental

a bit of history
	and jenkins

jenkins general:
	irc / mail notifications
	-> bugs are getting filed


d-i
	packages
	manual

lintian
debhelper
debconf-video

debian-edu
	images
	packages
	doc (!) 7 languages

reproducible builds 
	Debian, explain variations!
	/who/
	and qa
	and ximin (pb17)
rebootstrap

jenkins team maintenance
	helmut: rebootstrap
	mapreri + spectranaut: reproducible Debian
	fil: lvc
	tnn: jenkins java support
	sthibault: hurd + accessibility
	steven chamberlain: kfreebsd
	several: reproducible other than Debian

benefits for debian
	countless bug reports
		ie 2670 done ftbfs via reproducible…
	early notifications of problems

announce move to j.d.o
announce new nodes by codethink

-->


<body>
  <div class="reveal">
    <div class="slides" style="text-align: left;">
      <section data-background="images/debian_logo.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	jenkins.debian.net or what is Debian doing with all these ressources
	</h2>
        <h4>
          <br>
          Holger Levsen (h01ger)
        </h4>
      </section>

      <section data-background="images/h01ger.png" data-background-size="15%" data-background-color="black">
        <h2>about me</h2>
        <ul>
          <li class="fragment">Debian user since 1995</li>
          <li class="fragment">Debian contributor since 2001</li>
          <li class="fragment">DebConf organizer, founded the DebConf video team in 2005</li>
          <li class="fragment">Debian developer since 2007</li>
          <li class="fragment">Debian-Edu (Debian for Education), since 2003</li>
          <li class="fragment">Debian-QA</li>
          <li class="fragment">Freelancer at Profitbricks from 2012-2015</li>
        </ul>
      </section>

      <section data-background="images/h01ger.png" data-background-size="15%" data-background-color="black">
        <h2>more about Debian QA and me</h2>
        <ul>
          <li class="fragment">https://piuparts.debian.org/ since 2009</li>
          <li class="fragment">https://jenkins.debian.net/ since 2012</li>
          <li class="fragment">https://reproducible.debian.net/ since 2014</li>
          <li class="fragment">since 2015 funded by the Linux Foundation</li>
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	jenkins.debian.net contributors:
	</h2>
        <ul>
           <li>Phil Hands: lvc</li>
           <li>Helmut Grohne: rebootstrap</li>
           <li>Samuel Thibault: hurd + accessibility</li>
           <li>Steven Chamberlain: kfreebsd</li>
           <li>Tomasz Nitecki: jenkins java support</li>
           <li>Mattia Rizzolo, Valerie Young and others: reproducible Debian</li>
           <li>several: reproducible other than Debian</li>
	   <li class="fragment">36 contributors to jenkins.debian.net.git in total</li>
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	Profitbricks ressources used by jenkins.debian.net
	</h2>
        <ul>
          <li>2 datacenters (FKB + FRA)</li>
          <li>17 machines (16*Debian, 1*FreeBSD, 13*64bit, 4*32bit)</li>
          <li>168 cores (148 AMD, 20 Intel)</li>
          <li>498/503 GB RAM</li>
          <li>2.9/3.1 TB HDD storage</li>
          <li>2.9/2 TB SDD storage</li>
          <li>no static IP addresses</li>
          <li>2 DCD users: Mattia Rizzolo and me
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	Package (collection) installation tests
	</h2>
        <ul>
          <li>338 jobs</li>
          <li>wheezy (98), jessie (147), stretch (153), sid (98)</li>
          <li>upgrades and new installations tested</li>
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	g-i-installation tests
	</h2>
        <ul>
          <li>tests Debian Installer (d-i) in graphical mode ("g-i") and text mode too</li>
          <li>creates videos and screenshots</li>
          <li>plain Debian (installations and rescue mode) and Debian Edu</li>
          <li>kfreebsd and hurd</li>
          <li>finally almost deprecated today</li>
          <li>replaced by lvc tests (libvirt-cucumber)</li>
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	reproducible.debian.net
	</h2>
        <ul>
          <li>created by 379 jobs on jenkins.debian.net</li>
        </ul>
      </section>

      <section data-background="images/debian-jenkins.png" data-background-size="10%" data-background-position="90% 10%">
        <h2>
 	tests.reproducible-builds.org/debian/
	</h2>
        <ul>
          <li>created by ~350 jobs on jenkins.debian.net </li>
        </ul>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>The problem: why do we need reproducible builds?</h2>
        <ul>
          <li class="fragment">One can inspect the source code of free software for flaws</li>
          <li class="fragment">But distributions provide binary/compiled packages</li>
        </ul>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>Can we trust this process?</h2>

        <ul>
          <li class="fragment">To get users, go after the developers</li>
          <li class="fragment">Financial incentives to crack developer machines / build infrastructure</li>
          <li class="fragment"><code>CVE-2002-0083</code>: Remote root exploit in OpenSSH (single bit difference in binary)</li>
          <li class="fragment">Kernel module modifying source code when "viewed" by GCC only (see <code>media.ccc.de</code>)</li>
          <li class="fragment">Compromised Apple iOS SDK, <em>Xcodeghost</em>, etc.</li>
        </ul>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2 style="line-height: 130%;">
          The motivation behind "reproducible" builds is to allow verification
          that no flaws have been introduced during the compilation process.
        </h2>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
      <section>
        <h2>The solution</h2>

        <ol>FIXME wordings
          <li class="fragment">Ensure compilation always identical results</li>
          <li class="fragment">Multiple parties compare compilation results</li>
          <li class="fragment">Attacker needs to infect everybody simultaneously (or they are detected)</li>
        </ol>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>We call this <em>Reproducible Builds</em>.</h2>

        <ul>
          <li class="fragment">We think this should become the norm for free software.</li>
        </ul>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2>Reproducible builds in Debian</h2>

        <p>Continuously build every package twice, varying:</p>

        <ul class="fragment">
          <ul>
            <li>Time &amp; date</li>
            <li>Hostname &amp; domain name</li>
            <li>Filesystem (<code><strike>disorderfs</strike></code>)</li>
            <li>Timezone &amp; locale</li>
            <li><code>uid</code> &amp; <code>gid</code></li>
            <li>GECOS information, the shell &amp; a bunch of environment variables  </li>
            <li>Kernel &amp; CPU type</li>
            <li>and more&hellip;</li>
          </ul>
        </ul>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>Challenges</h2>
        <ul>
        <ul>
          <li>Timestamps</li>
          <li>Timezones &amp; locales</li>
          <li>Non-deterministic file ordering</li>
          <li>Dictionary/hash key ordering</li>
          <li>Users, groups, <code>umask</code>, environment variables</li>
          <li>Build paths</li>
          <li>Specifying the environment</li>
        </ul>
        </ul>
      </section>

      <section data-background="images/unstable_status.png" data-background-size="70%">
        &nbsp;
      </section>

      <section data-background="images/testing_status.png" data-background-size="70%">
        &nbsp;
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>Technical advantages</h2>

        <ul>
        <ul>
          <li>Faster to build; saves time, money &amp; the environment</li>
          <li>Easier to test changes/revisions</li>
          <li>Unsafe behaviour (eg. internet access)</li>
          <li>Unreliable / non-deterministic behaviours (eg. timing)</li>
          <li>Finds bugs in uncommon timezones or locales</li>
          <li>Detect corrupted build environments</li>
          <li>Find future build failures (eg. expired certificates)</li>
        </ul>
        </ul>
      </section>

      <section data-background="images/diffoscope.png" data-background-size="75%" data-background-position="50% 75%">
       <p><!-- FIXME: this is horrible… -->
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
         &nbsp;<br />
        <h2><code>https://try.diffoscope.org</code></h2>
       </p>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>Future work</h2>

        <ul>
          <li><code>.buildinfo</code> files distribution unsolved</li>
          <li>How to make it meaningful for end-users</li>
          <li>Source code still vulnerable</li>
        </ul>
      </section>

      <section data-background="images/stats_bugs_sin_ftbfs_state.png" data-background-size="70%">
        &nbsp;
      </section>

      <section>
        <h2>Beyond Debian&hellip;</h2>
        <p>
          <img src="images/logos/archlinux.png">
          <img src="images/logos/baserock.png">
          <img src="images/logos/bitcoin.png">
          <img src="images/logos/coreboot.png">
          <img src="images/logos/debian.png">
          <img src="images/logos/electrobsd.png">
          <img src="images/logos/f-droid.png">
          <img src="images/logos/fedora.png">
          <img src="images/logos/freebsd.png">
          <img src="images/logos/google.png">
          <img src="images/logos/guix.png">
          <img src="images/logos/lede.png">
          <img src="images/logos/netbsd.png">
          <img src="images/logos/nixos.png">
          <img src="images/logos/openSUSE.png">
          <img src="images/logos/openwrt.png">
          <img src="images/logos/tails.png">
          <img src="images/logos/tor.png">
          <img src="images/logos/webconverger.png">
          <ul>
           <li class="fragment">Reproducible Builds summits (Athens 2015, Berlin 2016)</li>
          </ul>
         </p>
      </section>

      <section data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>
 	 Ressources used by reproducible.debian.net, by architecture &amp; sponsor
	</h2>
        <ul>
          <li>13 amd64 systems, sponsored by Profitbricks</li>
          <li>4 i386 systems, sponsored by Profitbricks</li>
          <li>22 armhf systems, sponsored by vagrant@d.o, Debian &amp; other donations</li>
          <li>soon: 8 arm64 systems, sponsored by codethink.co.uk</li>
        </ul>
      </section>


      <section data-background-color="white" data-background="images/rbo.png" data-background-size="25%" data-background-position="90% 10%">
        <h2>Usual thanks:</h2>
        <p>
          <img src="images/cii.png">
          <br>
          <img src="images/lf.png">
          <br>
          <img src="images/profitbricks.jpg">
          <br>
          <img src="images/debian_logo.png">
        </p>
      </section>

      <section data-background="images/wholeworld.jpg" data-background-size="24%" data-background-position="92% 45%">
        <h2>Todays special thanks:</h2>
        <p>
          <img src="images/profitbricks.jpg">
	  <ul>
            <li>from Debian, jenkins.debian.net would not have been possible like this without <em>your support!</em></li>
            <li>from many many folks interested in Reproducible Builds</li>
          </ul>
        </p>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2 style="text-align: center;">Questions?</h2>

        <br>
        <br>

        <table>
        <tr>
          <td>
            <a href="mailto:holger@debian.org">holger@debian.org</a>
          </td>
          <td style="text-align: right;">
            <code>B8BF 5413 7B09 D35C F026  FE9D 091A B856 069A AA1C</code>
          </td>
        </tr>
        </table>

        <br>

        <p style="text-align: center;">
          <a href="https://jenkins.debian.net/"><code>https://jenkins.debian.net</code></a>
          <br>
          <a href="https://reproducible-builds.org/"><code>https://reproducible-builds.org</code></a>
        </p>
      </section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
  <script>
    Reveal.initialize({
      controls: false,
      progress: false,
      history: true
    });
  </script>
</body>
</html>
